<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - SAMIRs Point Of View</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-lightbulb"></i>
                    </div>
                    <div class="logo-text">
                        <h1>SAMIRs Point Of View</h1>
                        <p>Admin Panel</p>
                    </div>
                </div>
                <nav>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="blog.html">Blog</a></li>
                        <li><a href="admin.html" class="active admin-link">Admin</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <!-- Admin Panel -->
    <section class="admin-panel">
        <div class="container">
            <div class="admin-header">
                <h1>Blog Management</h1>
                <p>Manage your blog posts and content</p>
                <button class="add-post-btn" onclick="openPostModal()">
                    <i class="fas fa-plus"></i> Create New Post
                </button>
            </div>

            <!-- Statistics -->
            <div class="admin-stats">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalPosts">0</h3>
                        <p>Total Posts</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-layer-group"></i>
                    </div>
                    <div class="stat-info">
                        <h3>6</h3>
                        <p>Categories</p>
                    </div>
                </div>
            </div>

            <!-- Posts List -->
            <div class="posts-management">
                <h2>All Blog Posts</h2>
                <div class="posts-list" id="postsList">
                    <!-- Posts will be loaded here -->
                </div>
            </div>
        </div>
    </section>

    <!-- Post Modal -->
    <div class="modal" id="postModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Create New Post</h2>
                <button class="close-btn" onclick="closePostModal()">&times;</button>
            </div>
            
            <form id="postForm" onsubmit="savePost(event)">
                <div class="form-group">
                    <label for="postTitle">Post Title *</label>
                    <input type="text" id="postTitle" required placeholder="Enter a compelling title">
                </div>

                <div class="form-group">
                    <label for="postCategory">Category *</label>
                    <select id="postCategory" required>
                        <option value="">Select a category</option>
                        <option value="productivity">Productivity</option>
                        <option value="relationships">Relationships</option>
                        <option value="finance">Finance</option>
                        <option value="health">Health & Wellness</option>
                        <option value="personal-growth">Personal Growth</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="postExcerpt">Short Description *</label>
                    <textarea id="postExcerpt" required placeholder="Write a brief description (2-3 sentences)" maxlength="200"></textarea>
                    <div class="char-count"><span id="excerptCount">0</span>/200</div>
                </div>

                <div class="form-group">
                    <label for="postContent">Full Content *</label>
                    <textarea id="postContent" required placeholder="Write your full blog post content here..." rows="10"></textarea>
                </div>

                <div class="form-group">
                    <label for="postImage">Featured Image URL</label>
                    <input type="url" id="postImage" placeholder="https://example.com/image.jpg">
                    <small>Recommended: 1200x600px image from Unsplash</small>
                </div>

                <div class="form-group">
                    <label for="postReadTime">Estimated Read Time (minutes) *</label>
                    <input type="number" id="postReadTime" required min="1" max="60" value="5">
                </div>

                <div class="form-actions">
                    <button type="button" class="cancel-btn" onclick="closePostModal()">Cancel</button>
                    <button type="submit" class="save-btn">
                        <i class="fas fa-save"></i> Save Post
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Instructions Modal -->
    <div class="modal" id="instructionsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Next Steps</h2>
                <button class="close-btn" onclick="closeInstructionsModal()">&times;</button>
            </div>
            <div class="instructions-content">
                <div id="instructionsText"></div>
                <div class="instruction-actions">
                    <button class="copy-btn" onclick="copyPostCode()">
                        <i class="fas fa-copy"></i> Copy HTML Code
                    </button>
                    <button class="close-btn" onclick="closeInstructionsModal()">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/admin.js"></script>
    <script>
        let currentEditingPost = null;
        let allPosts = [];

        document.addEventListener('DOMContentLoaded', async function() {
            allPosts = await getAllPosts();
            displayPostsList();
            updateStats();
            
            // Character count for excerpt
            document.getElementById('postExcerpt').addEventListener('input', function() {
                document.getElementById('excerptCount').textContent = this.value.length;
            });
        });

        function openPostModal(post = null) {
            currentEditingPost = post;
            const modal = document.getElementById('postModal');
            const form = document.getElementById('postForm');
            
            if (post) {
                document.getElementById('modalTitle').textContent = 'Edit Post';
                document.getElementById('postTitle').value = post.title;
                document.getElementById('postCategory').value = post.category;
                document.getElementById('postExcerpt').value = post.excerpt;
                document.getElementById('postContent').value = post.content;
                document.getElementById('postImage').value = post.image;
                document.getElementById('postReadTime').value = post.readTime;
                document.getElementById('excerptCount').textContent = post.excerpt.length;
            } else {
                document.getElementById('modalTitle').textContent = 'Create New Post';
                form.reset();
                document.getElementById('excerptCount').textContent = '0';
            }
            
            modal.style.display = 'flex';
        }

        function closePostModal() {
            document.getElementById('postModal').style.display = 'none';
            currentEditingPost = null;
        }

        function savePost(event) {
            event.preventDefault();
            
            const postData = {
                title: document.getElementById('postTitle').value,
                category: document.getElementById('postCategory').value,
                excerpt: document.getElementById('postExcerpt').value,
                content: document.getElementById('postContent').value,
                image: document.getElementById('postImage').value || getDefaultImage(document.getElementById('postCategory').value),
                readTime: parseInt(document.getElementById('postReadTime').value),
                date: currentEditingPost ? currentEditingPost.date : new Date().toISOString().split('T')[0],
                file: currentEditingPost ? currentEditingPost.file : `posts/post-${Date.now()}.html`
            };

            showPostInstructions(postData);
            closePostModal();
        }

        function getDefaultImage(category) {
            const images = {
                productivity: 'https://images.unsplash.com/photo-1484480974693-6ca0a78fb36b?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80',
                relationships: 'https://images.unsplash.com/photo-1552058544-f2b08422138a?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80',
                finance: 'https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80',
                health: 'https://images.unsplash.com/photo-1571019614244-c5c5a73a7c41?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80',
                'personal-growth': 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80',
                other: 'https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80'
            };
            return images[category] || images.other;
        }

        function showPostInstructions(postData) {
            const htmlCode = generatePostHTML(postData);
            
            const instructions = `
                <h3>🎉 Post Ready to Publish!</h3>
                <p>Follow these steps to add your post to the website:</p>
                
                <div class="instruction-steps">
                    <div class="step">
                        <strong>Step 1:</strong> Create a new file in your GitHub repository
                    </div>
                    <div class="step">
                        <strong>Step 2:</strong> Name the file: <code>${postData.file}</code>
                    </div>
                    <div class="step">
                        <strong>Step 3:</strong> Copy the HTML code below and paste it into the file
                    </div>
                    <div class="step">
                        <strong>Step 4:</strong> Commit your changes
                    </div>
                </div>
                
                <div class="code-preview">
                    <h4>HTML Code to Copy:</h4>
                    <pre><code>${htmlCode}</code></pre>
                </div>
            `;
            
            document.getElementById('instructionsText').innerHTML = instructions;
            document.getElementById('instructionsModal').style.display = 'flex';
        }

        function generatePostHTML(post) {
            return `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${post.title} - SAMIRs Point Of View</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-lightbulb"></i>
                    </div>
                    <div class="logo-text">
                        <h1>SAMIRs Point Of View</h1>
                        <p>Daily Living Problems & Solutions</p>
                    </div>
                </div>
                <nav>
                    <ul>
                        <li><a href="../index.html">Home</a></li>
                        <li><a href="../blog.html">Blog</a></li>
                        <li><a href="../admin.html" class="admin-link">Admin</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <section class="single-post">
        <div class="container">
            <article class="post-content">
                <div class="post-header">
                    <span class="post-category">${post.category}</span>
                    <h1>${post.title}</h1>
                    <div class="post-meta">
                        <span><i class="far fa-calendar"></i> ${post.date}</span>
                        <span><i class="far fa-clock"></i> ${post.readTime} min read</span>
                    </div>
                </div>
                
                ${post.image ? `<div class="featured-image">
                    <img src="${post.image}" alt="${post.title}">
                </div>` : ''}
                
                <div class="post-body">
                    ${post.content.split('\\n').map(paragraph => `<p>${paragraph}</p>`).join('')}
                </div>
                
                <div class="post-actions">
                    <a href="../blog.html" class="back-btn">
                        <i class="fas fa-arrow-left"></i> Back to Blog
                    </a>
                </div>
            </article>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>SAMIRs Point Of View</h3>
                    <p>Practical solutions for everyday living problems.</p>
                </div>
                <div class="footer-column">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="../index.html">Home</a></li>
                        <li><a href="../blog.html">Blog</a></li>
                        <li><a href="../admin.html">Admin Panel</a></li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2024 SAMIRs Point Of View. All rights reserved.</p>
            </div>
        </div>
    </footer>
</body>
</html>`;
        }

        function copyPostCode() {
            const codeElement = document.querySelector('.code-preview code');
            const textArea = document.createElement('textarea');
            textArea.value = codeElement.textContent;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            
            alert('HTML code copied to clipboard! Now create the file in GitHub and paste this code.');
        }

        function closeInstructionsModal() {
            document.getElementById('instructionsModal').style.display = 'none';
            // Reload posts list
            location.reload();
        }

        function displayPostsList() {
            const postsList = document.getElementById('postsList');
            
            if (allPosts.length === 0) {
                postsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-file-alt"></i>
                        <h3>No Posts Yet</h3>
                        <p>Create your first blog post to get started!</p>
                        <button class="add-post-btn" onclick="openPostModal()">
                            <i class="fas fa-plus"></i> Create First Post
                        </button>
                    </div>
                `;
                return;
            }
            
            postsList.innerHTML = allPosts.map(post => `
                <div class="post-item">
                    <div class="post-info">
                        <h3>${post.title}</h3>
                        <div class="post-meta">
                            <span class="category">${post.category}</span>
                            <span>${post.date}</span>
                            <span>${post.readTime} min read</span>
                        </div>
                    </div>
                    <div class="post-actions">
                        <a href="${post.file}" target="_blank" class="view-btn">
                            <i class="fas fa-eye"></i> View
                        </a>
                        <button class="edit-btn" onclick="openPostModal(${JSON.stringify(post).replace(/"/g, '&quot;')})">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="delete-btn" onclick="deletePost('${post.file}')">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function updateStats() {
            document.getElementById('totalPosts').textContent = allPosts.length;
        }

        function deletePost(fileName) {
            if (confirm('Are you sure you want to delete this post? This action cannot be undone.')) {
                alert(`To delete this post, go to your GitHub repository and delete the file: ${fileName}`);
            }
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }
    </script>
</body>
</html>
